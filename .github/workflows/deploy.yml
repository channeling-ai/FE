name: Deploy by Syncing

on:
    push:
        branches: ['main', 'develop']

jobs:
    sync-and-deploy:
        runs-on: ubuntu-latest

        steps:
            - name: â–¶ï¸ Checkout repository
              uses: actions/checkout@v4

            - name: ðŸ›  Create output directory for sync
              run: sh ./scripts/build.sh

            - name: ðŸ“ Set timestamp & Commit Message
              run: |
                  echo "TIMESTAMP=$(date -u +'%Y-%m-%dT%H:%M:%SZ')" >> $GITHUB_ENV
                  echo "COMMIT_MSG=$(git log -1 --pretty=%s)" >> $GITHUB_ENV

            - name: âœ… Push to another repository
              uses: cpina/github-action-push-to-another-repository@main
              env:
                  API_TOKEN_GITHUB: ${{ secrets.AUTO_ACTIONS }}
              with:
                  source-directory: 'output'
                  destination-github-username: 'channeling8'
                  destination-repository-name: 'channeling-FE'
                  user-email: ${{ secrets.EMAIL }}
                  target-branch: ${{ github.ref_name }}
                  commit-message: '[DEPLOY] ${{ env.COMMIT_MSG }} (auto-synced at ${{ env.TIMESTAMP }})'

            - name: ðŸ§ª Test get variable exported by push-to-another-repository
              run: echo $DESTINATION_CLONED_DIRECTORY
